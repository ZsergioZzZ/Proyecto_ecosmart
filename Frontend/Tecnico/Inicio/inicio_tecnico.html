<div data-layer="Tecnico Inicio" class="TecnicoInicio" style="width: 1543px; height: 2457px; position: relative; background: #FBF9F4; overflow: hidden">
  <div data-layer="Con EcoSmart tienes información oportuna para la toma de desiciones del control de tu cosecha" class="ConEcosmartTienesInformaciNOportunaParaLaTomaDeDesicionesDelControlDeTuCosecha" style="width: 1201px; height: 241px; left: 190px; top: 910px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #344E41; font-size: 48px; font-family: IBM Plex Mono; font-weight: 700; line-height: 28px; word-wrap: break-word">Con EcoSmart tienes información oportuna<br/><br/>para la toma de desiciones del control de<br/> <br/>tu cosecha</div>
  <div data-layer="Rectangle 24" class="Rectangle24" style="width: 645px; height: 541px; left: 82px; top: 1180px; position: absolute; background: #A3B18A; border-radius: 14px"></div>
  
  <!--Navegacion paginas-->
  <a href="/Frontend/Tecnico/Configuracion_del_sistema/configuracion.html"
    style="width: 401px; height: 89px; left: 198px; top: 1220px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: black; font-size: 36px; font-family: IBM Plex Mono; font-weight: 700; text-decoration: underline; line-height: 28px; word-wrap: break-word">
    Configuración del sistema
  </a>
  <!---------------------->

  <div data-layer="Agrega, modifica o elimina parcelas y sensores." class="AgregaParcelasSensores" style="width: 589px; height: 128px; left: 112px; top: 1550px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: black; font-size: 32px; font-family: Roboto; font-weight: 300; line-height: 28px; word-wrap: break-word">Agrega, modifica o elimina parcelas y sensores.</div>
  <div data-layer="datos 1" class="Datos1" style="width: 186.06px; height: 186.06px; left: 305.47px; top: 1357.47px; position: absolute"></div>
  

  <div data-layer="inversion (1)" class="Inversion1" style="width: 169.04px; height: 169.04px; left: 685.48px; top: 1971.99px; position: absolute"></div>
  <div data-layer="Rectangle 25" class="Rectangle25" style="width: 645px; height: 541px; left: 812px; top: 1180px; position: absolute; background: #A3B18A; border-radius: 14px"></div>
  
  <!--Navegacion paginas-->
  <a href="/Frontend/Tecnico/Configuracion_de_alertas/configuracion_alertas.html"
    style="width: 444px; height: 89px; left: 913px; top: 1220px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: black; font-size: 36px; font-family: IBM Plex Mono; font-weight: 700; text-decoration: underline; line-height: 28px; word-wrap: break-word">
    Configuración de Alertas
  </a>
  <!---------------------->


  <div data-layer="Rectangle 24" class="Rectangle24" style="width: 1373px; height: 541px; left: 84px; top: 1818px; position: absolute; background: #A3B18A; border-radius: 14px"></div>
  <div data-layer="Registra, modifica o elimina usuarios" class="usuario" style="width: 1253.79px; height: 128px; left: 147.86px; top: 2180px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: black; font-size: 32px; font-family: Roboto; font-weight: 300; line-height: 28px; word-wrap: break-word">Registra, modifica o elimina usuarios</div>
  <img data-layer="imagenUsuario" class="imagenusuario1" style="width: 169.04px; height: 169.04px; left: 685.48px; top: 1971.98px; position: absolute" src="imagenes/nuevo-usuario.png" />
  <a href="/Frontend/Tecnico/Configuracion_usuarios/usuarios.html"
    style="width: 853.60px; height: 89px; left: 330.93px; top: 1844px; position: absolute; text-align: center; justify-content: 
    center; display: flex; flex-direction: column; color: black; font-size: 36px; font-family: IBM Plex Mono; font-weight: 700; 
    text-decoration: underline; line-height: 28px; word-wrap: break-word">
    Configuraciones de usuarios
  </a>

  <div data-layer="Crea alertas personalizadas según tus necesidades para comenzar a monitorear tus cultivos." class="configuraAlertas" style="width: 589.68px; height: 128px; left: 833.66px; top: 1550px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: black; font-size: 32px; font-family: Roboto; font-weight: 300; line-height: 28px; word-wrap: break-word">Crea alertas personalizadas según tus necesidades para comenzar a monitorear tus cultivos.</div>
  <div data-layer="bot (3)" class="Bot3" style="width: 186.06px; height: 186.06px; left: 1041.47px; top: 1341.88px; position: absolute"></div>
  <div data-layer="EcoSmart" class="Ecosmart" style="width: 344px; height: 106px; left: 23px; top: 76px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #344E41; font-size: 64px; font-family: IBM Plex Mono; font-weight: 700; line-height: 28px; word-wrap: break-word">EcoSmart</div>
  <img data-layer="plantacion (6)" class="Plantacion6" style="width: 76px; height: 76px; left: 157px; top: 38px; position: absolute" src="imagenes/plantacion (6).png" />
  <img data-layer="Imagen Cultivo" class="ImagenCultivo" style="width: 1597.01px; height: 674px; left: 0px; top: 229px; position: absolute" src="imagenes/imagen-cultivo.JPG" />
  <div data-layer="EcoSmart nace como respuesta a desafíos como el cambio climático, la escasez de recursos hídricos y reducir el impacto ambiental de las prácticas agrícolas tradicionales, proporcionando una plataforma integral que aprovecha tecnologías de vanguardia para revolucionar la forma en que se gestiona la agricultura, desde pequeñas explotaciones hasta operaciones comerciales a gran escala." class="EcosmartNaceComoRespuestaADesafOsComoElCambioClimTicoLaEscasezDeRecursosHDricosYReducirElImpactoAmbientalDeLasPrCticasAgrColasTradicionalesProporcionandoUnaPlataformaIntegralQueAprovechaTecnologAsDeVanguardiaParaRevolucionarLaFormaEnQueSeGestionaLaAgriculturaDesdePequeAsExplotacionesHastaOperacionesComercialesAGranEscala" style="width: 1077px; height: 368px; left: 43px; top: 161px; position: absolute; justify-content: center; display: flex; flex-direction: column; color: black; font-size: 32px; font-family: Roboto; font-weight: 300; line-height: 28px; word-wrap: break-word">EcoSmart nace como respuesta a desafíos como el cambio climático,  la escasez de recursos hídricos y reducir el impacto ambiental de las <br/>prácticas agrícolas tradicionales, proporcionando una <br/>plataforma integral que aprovecha tecnologías de <br/>vanguardia para revolucionar la forma en que <br/>se gestiona la agricultura, desde pequeñas <br/>explotaciones hasta operaciones <br/>comerciales a gran <br/>escala.</div>
  <div data-layer="Rectangle 1" class="Rectangle1" style="width: 223px; height: 72px; left: 1270px; top: 38px; position: absolute; background: #588157; border-radius: 28px"></div>
  <img data-layer="avatar" class="Avatar" style="width: 37px; height: 37px; left: 1287px; top: 55px; position: absolute" src="imagenes/avatar.png" />
  <img data-layer="configuracion-del-sistema 1" class="ConfiguracionDelSistema1" style="width: 186px; height: 186px; left: 313px; top: 1343px; position: absolute" src="imagenes/configuracion-del-sistema.png" />
  <img data-layer="mantenimiento-web 1" class="MantenimientoWeb1" style="width: 186px; height: 186px; left: 1042px; top: 1343px; position: absolute" src="imagenes/mantenimiento-web.png" />
  <div id="nombre-usuario-tecnico" style="width: 127px; height: 45px; left: 1336px; top: 51px; position: absolute; text-align: center; justify-content: center; display: flex; flex-direction: column; color: white; font-size: 20px; font-family: IBM Plex Mono; font-weight: 700; line-height: 28px; word-wrap: break-word">Técnico</div>
  <script>
    const nombre = localStorage.getItem("nombreUsuario");
    if (nombre) {
      document.getElementById("nombre-usuario-tecnico").textContent = nombre;
    }
  </script>


  <!-- Menú desplegable oculto -->
  <div id="menuOpciones"
      style="display: none; width: 203px; position: absolute;
              top: 120px; left: 1270px; background: #344E41;
              border-radius: 10px; padding: 10px;">
    <a id="logoutLink"
      href="/Frontend/Inicio_de_sesion/Inicio/inicio.html"
      style="display: flex; justify-content: center; color: white;
              text-decoration: none; font-family: IBM Plex Mono;
              font-weight: 550; font-size: 18px;">
      Cerrar sesión
    </a>
  </div>

  <script>
    const avatar = document.querySelector('img[src="imagenes/avatar.png"]');
    const nombreUsuario = document.getElementById("nombre-usuario-tecnico");
    const menu = document.getElementById("menuOpciones");
    const logoutLink = document.getElementById("logoutLink");

    function toggleMenu() {
      menu.style.display = (menu.style.display === "none" || menu.style.display === "") ? "block" : "none";
    }
    avatar.addEventListener("click", toggleMenu);
    nombreUsuario.addEventListener("click", toggleMenu);

    // Al cerrar sesión, limpiar storage y permitir navegación
    logoutLink.addEventListener("click", () => {
      localStorage.clear();
    });
  </script>


<!-- --------------------------------
     Notificaciones emergentes
-------------------------------- -->

<!-- Icono de campana -->
<div id="notificacion-contenedor" style="position: absolute; top: 59px; left: 1150px; cursor: pointer;">
  <svg id="campana-icono" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="#344E41" title="Notificaciones">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 22c1.1 0 1.99-.9 1.99-2h-4A1.99 1.99 0 0012 22zm6-6V9a6 6 0 00-12 0v7l-2 2v1h16v-1l-2-2z"/>
  </svg>
  <span id="burbuja-noti" style="
    display: none;
    position: absolute;
    top: -5px;
    right: -5px;
    background: red;
    color: white;
    font-size: 12px;
    padding: 3px 7px;
    border-radius: 50%;
    font-family: Arial, sans-serif;
    font-weight: bold;
    z-index: 1000;">0</span>
</div>

<!-- Panel emergente -->
<div id="panel-notificaciones" style="
  display: none;
  position: absolute;
  top: 115px; left: 1150px; width: 320px; max-width: 90vw;
  background-color: white; border: 1px solid #ccc; border-radius: 10px;
  box-shadow: 0px 4px 10px rgba(0,0,0,0.15); padding: 12px; z-index: 999;
  font-family: 'IBM Plex Mono'; font-size: 14px; color: #344E41;
">
  <strong>Notificaciones recientes</strong>
  <div style="max-height: 330px; overflow-y: auto; margin-top: 10px;">
    <ul id="lista-notificaciones" style="list-style: none; padding: 0; margin: 0;">
      <li>No hay notificaciones nuevas.</li>
    </ul>
  </div>
</div>c

<!-- Modal de recomendaciones -->
<div id="modal-recomendacion" style="
  display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
  
  <div style="
    background-color: white; padding: 20px; border-radius: 10px; width: 400px; max-width: 90%;
    font-family: 'IBM Plex Mono'; color: #344E41; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
    
    <h3 style="margin-top: 0; color: #344E41;" id="titulo-recomendacion">Recomendaciones</h3>
    <p id="contenido-recomendacion">Aquí se mostrarán las recomendaciones para esta alerta.</p>
    
    <div style="text-align: right; margin-top: 15px;">
      <button onclick="cerrarModalRecomendacion()" style="
        background-color: #a3b18a; border: none; padding: 8px 12px;
        border-radius: 6px; cursor: pointer; color: white;">
        Cerrar
      </button>
    </div>
  </div>
</div>

<script>
  const campana = document.getElementById("campana-icono");
  const panel = document.getElementById("panel-notificaciones");
  const burbuja = document.getElementById("burbuja-noti");

  campana.addEventListener("click", () => {
    panel.style.display = panel.style.display === "none" ? "block" : "none";
  });

  // Cargar notificaciones desde backend
  async function cargarNotificaciones() {
    const correo = localStorage.getItem("correoUsuario");
    const ul = document.getElementById("lista-notificaciones");

    if (!correo) {
      ul.innerHTML = "<li>No se encontró correo de usuario</li>";
      burbuja.style.display = "none";
      return;
    }

    ul.innerHTML = "<li>Cargando notificaciones...</li>";

    try {
      const res = await fetch(`http://localhost:5000/notificaciones?correo=${correo}`);
      const datos = await res.json();

      ul.innerHTML = "";

      if (datos.length > 0) {
        burbuja.textContent = datos.length;
        burbuja.style.display = "inline-block";
      } else {
        burbuja.style.display = "none";
        ul.innerHTML = "<li>No hay notificaciones activas.</li>";
        return;
      }

      datos.forEach(noti => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${noti.nombre_alerta}</strong><br>
          ${noti.descripcion}<br>
          <em>${noti.parcela}</em><br>
          <small>${new Date(noti.timestamp_alerta).toLocaleString()}</small><br>
          <div style="margin-top: 5px;">
            <button style="background-color:#a3b18a; border:none; padding:5px 10px; border-radius:6px; cursor:pointer; margin-right:5px"
              onclick="marcarLeida('${noti._id}')">Descartar</button>
            <button style="background-color:#344E41; color:white; border:none; padding:5px 10px; border-radius:6px; cursor:pointer"
              onclick="mostrarRecomendacion('${noti._id}', '${noti.nombre_alerta}')">Recomendaciones</button>
          </div>
        `;
        li.style.marginBottom = "10px";
        ul.appendChild(li);
      });
    } catch (error) {
      console.error("Error al cargar notificaciones:", error);
      ul.innerHTML = "<li>Error al conectar con el servidor.</li>";
      burbuja.style.display = "none";
    }
  }

  async function marcarLeida(id) {
    try {
      const res = await fetch("http://localhost:5000/notificaciones/marcar-leida", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id })
      });

      if (res.ok) {
        cargarNotificaciones();
      } else {
        alert("Error al marcar como leída");
      }
    } catch (err) {
      console.error("Error:", err);
      alert("No se pudo conectar al servidor.");
    }
  }

  async function mostrarRecomendacion(idAlerta, nombreAlerta) {
    try {
      const res = await fetch(`http://localhost:5000/recomendaciones/${idAlerta}`);
      const data = await res.json();

      document.getElementById("titulo-recomendacion").textContent = `Recomendaciones: ${nombreAlerta}`;
      document.getElementById("contenido-recomendacion").textContent = data.recomendacion || "No se pudo obtener una recomendación.";
      document.getElementById("modal-recomendacion").style.display = "flex";
    } catch (err) {
      console.error("Error al obtener recomendación:", err);
      document.getElementById("contenido-recomendacion").textContent = "Hubo un problema al generar la recomendación.";
      document.getElementById("modal-recomendacion").style.display = "flex";
    }
  }

  function cerrarModalRecomendacion() {
    document.getElementById("modal-recomendacion").style.display = "none";
  }

  document.addEventListener("DOMContentLoaded", cargarNotificaciones);
  campana.addEventListener("click", cargarNotificaciones);
</script>



</div>